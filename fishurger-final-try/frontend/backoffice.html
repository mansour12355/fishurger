<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fishburger - Backoffice Dashboard</title>

    <!-- Premium Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Playfair+Display:ital,wght@0,700;1,700&display=swap"
        rel="stylesheet">

    <!-- Icons and CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-gradient"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    },
                    colors: {
                        brand: {
                            primary: '#FF4500',
                            secondary: '#1e3a8a',
                            dark: '#0f172a',
                            light: '#f8fafc',
                        }
                    }
                }
            }
        }
    </script>

    <style>
        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .gradient-text {
            background: linear-gradient(135deg, #FF4500 0%, #ff8c00 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(15, 23, 42, 0.1);
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255, 69, 0, 0.3);
            border-radius: 10px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
    </style>
</head>

<body class="bg-[#0b0f19] text-slate-200 font-sans custom-scrollbar">
    <!-- Sidebar -->
    <div
        class="fixed left-0 top-0 h-full w-20 md:w-64 bg-[#0f172a] border-r border-slate-800 z-50 flex flex-col items-center py-8">
        <div class="mb-12">
            <div
                class="bg-brand-primary w-12 h-12 rounded-2xl flex items-center justify-center shadow-lg shadow-brand-primary/20">
                <i class="fa-solid fa-fish text-2xl text-white"></i>
            </div>
        </div>

        <nav class="flex-1 space-y-4 px-4 w-full">
            <a href="#"
                class="flex items-center gap-4 p-3 rounded-xl bg-slate-800/50 text-brand-primary border border-brand-primary/30 transition-all group">
                <i class="fa-solid fa-chart-line text-lg w-6 flex justify-center"></i>
                <span class="hidden md:block font-semibold">Dashboard</span>
            </a>
            <a href="kitchen-firebase.html"
                class="flex items-center gap-4 p-3 rounded-xl hover:bg-slate-800/30 text-slate-400 hover:text-white transition-all group">
                <i class="fa-solid fa-fire-burner text-lg w-6 flex justify-center"></i>
                <span class="hidden md:block font-medium">Kitchen</span>
            </a>
            <a href="delivery-firebase.html"
                class="flex items-center gap-4 p-3 rounded-xl hover:bg-slate-800/30 text-slate-400 hover:text-white transition-all group">
                <i class="fa-solid fa-truck-fast text-lg w-6 flex justify-center"></i>
                <span class="hidden md:block font-medium">Delivery</span>
            </a>
            <a href="main.html"
                class="flex items-center gap-4 p-3 rounded-xl hover:bg-slate-800/30 text-slate-400 hover:text-white transition-all group">
                <i class="fa-solid fa-house text-lg w-6 flex justify-center"></i>
                <span class="hidden md:block font-medium">Home Page</span>
            </a>
        </nav>

        <div class="mt-auto px-4 w-full">
            <button
                class="flex items-center gap-4 p-3 rounded-xl hover:bg-red-500/10 text-slate-500 hover:text-red-400 transition-all w-full">
                <i class="fa-solid fa-right-from-bracket text-lg w-6 flex justify-center"></i>
                <span class="hidden md:block font-medium">Sign Out</span>
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <main class="ml-20 md:ml-64 p-4 md:p-8 min-h-screen">
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8 animate-fade-in"
            style="animation-delay: 0.1s">
            <div>
                <h1 class="text-3xl font-bold text-white mb-2">Backoffice Dashboard</h1>
                <p class="text-slate-400">Track your business performance in real-time.</p>
            </div>
            <div class="flex items-center gap-4 bg-slate-800/50 p-2 rounded-2xl border border-slate-700/50">
                <div
                    class="flex items-center gap-2 px-3 py-1.5 bg-green-500/10 text-green-400 rounded-xl border border-green-500/20 text-sm font-medium">
                    <span class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></span>
                    Live Data
                </div>
                <div id="current-time" class="text-slate-300 font-medium px-2"></div>
            </div>
        </header>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8 animate-fade-in"
            style="animation-delay: 0.2s">
            <div class="glass-card rounded-2xl p-6 hover:-translate-y-1 transition-all duration-300">
                <div class="flex justify-between items-start mb-4">
                    <div
                        class="w-12 h-12 bg-blue-500/10 rounded-xl flex items-center justify-center border border-blue-500/20">
                        <i class="fa-solid fa-dollar-sign text-blue-400 text-xl"></i>
                    </div>
                    <span
                        class="text-xs font-bold text-blue-400 uppercase tracking-widest px-2 py-1 bg-blue-500/10 rounded-lg">Revenue</span>
                </div>
                <div class="text-3xl font-bold text-white mb-1" id="stat-revenue">0 DH</div>
                <p class="text-slate-400 text-sm">Total Sales Today</p>
            </div>

            <div class="glass-card rounded-2xl p-6 hover:-translate-y-1 transition-all duration-300">
                <div class="flex justify-between items-start mb-4">
                    <div
                        class="w-12 h-12 bg-orange-500/10 rounded-xl flex items-center justify-center border border-orange-500/20">
                        <i class="fa-solid fa-receipt text-orange-400 text-xl"></i>
                    </div>
                    <span
                        class="text-xs font-bold text-orange-400 uppercase tracking-widest px-2 py-1 bg-orange-500/10 rounded-lg">Orders</span>
                </div>
                <div class="text-3xl font-bold text-white mb-1" id="stat-orders">0</div>
                <p class="text-slate-400 text-sm">Completed Orders</p>
            </div>

            <div class="glass-card rounded-2xl p-6 hover:-translate-y-1 transition-all duration-300">
                <div class="flex justify-between items-start mb-4">
                    <div
                        class="w-12 h-12 bg-purple-500/10 rounded-xl flex items-center justify-center border border-purple-500/20">
                        <i class="fa-solid fa-utensils text-purple-400 text-xl"></i>
                    </div>
                    <span
                        class="text-xs font-bold text-purple-400 uppercase tracking-widest px-2 py-1 bg-purple-500/10 rounded-lg">Avg.
                        Bill</span>
                </div>
                <div class="text-3xl font-bold text-white mb-1" id="stat-avg">0 DH</div>
                <p class="text-slate-400 text-sm">Per Transaction</p>
            </div>

            <div class="glass-card rounded-2xl p-6 hover:-translate-y-1 transition-all duration-300">
                <div class="flex justify-between items-start mb-4">
                    <div
                        class="w-12 h-12 bg-green-500/10 rounded-xl flex items-center justify-center border border-green-500/20">
                        <i class="fa-solid fa-hourglass-half text-green-400 text-xl"></i>
                    </div>
                    <span
                        class="text-xs font-bold text-green-400 uppercase tracking-widest px-2 py-1 bg-green-500/10 rounded-lg">Pending</span>
                </div>
                <div class="text-3xl font-bold text-white mb-1" id="stat-pending">0</div>
                <p class="text-slate-400 text-sm">Awaiting Preparation</p>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8 animate-fade-in" style="animation-delay: 0.3s">
            <!-- Sales Trend -->
            <div class="lg:col-span-2 glass-card rounded-3xl p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-white">Sales Analysis</h3>
                    <select
                        class="bg-slate-800 border-none rounded-xl text-sm text-slate-300 px-4 py-2 focus:ring-1 focus:ring-brand-primary">
                        <option>Last 7 Days</option>
                        <option>Last 30 Days</option>
                        <option>Last Month</option>
                    </select>
                </div>
                <div class="h-[300px]">
                    <canvas id="salesChart"></canvas>
                </div>
            </div>

            <!-- Location Performance -->
            <div class="glass-card rounded-3xl p-6">
                <h3 class="text-xl font-bold text-white mb-6">Location Split</h3>
                <div class="h-[250px] relative">
                    <canvas id="locationChart"></canvas>
                </div>
                <div class="mt-6 flex flex-col gap-3">
                    <div class="flex justify-between items-center px-4 py-2 bg-slate-800/30 rounded-xl">
                        <div class="flex items-center gap-3">
                            <span class="w-3 h-3 rounded-full bg-blue-500"></span>
                            <span class="font-medium">Rooftop</span>
                        </div>
                        <span id="loc-rooftop" class="font-bold text-white">0%</span>
                    </div>
                    <div class="flex justify-between items-center px-4 py-2 bg-slate-800/30 rounded-xl">
                        <div class="flex items-center gap-3">
                            <span class="w-3 h-3 rounded-full bg-green-500"></span>
                            <span class="font-medium">Medina</span>
                        </div>
                        <span id="loc-medina" class="font-bold text-white">0%</span>
                    </div>
                    <div class="flex justify-between items-center px-4 py-2 bg-slate-800/30 rounded-xl">
                        <div class="flex items-center gap-3">
                            <span class="w-3 h-3 rounded-full bg-orange-500"></span>
                            <span class="font-medium">Casablanca</span>
                        </div>
                        <span id="loc-casa" class="font-bold text-white">0%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Orders Table -->
        <div class="glass-card rounded-3xl p-6 animate-fade-in" style="animation-delay: 0.4s">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h3 class="text-xl font-bold text-white">Live Transactions</h3>
                    <p class="text-sm text-slate-400">Showing the last 10 activities</p>
                </div>
                <button
                    class="bg-slate-800 hover:bg-slate-700 text-white px-5 py-2.5 rounded-2xl text-sm font-semibold transition-all">
                    Export Report
                </button>
            </div>

            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead>
                        <tr class="text-slate-500 text-xs font-bold uppercase tracking-wider border-b border-slate-800">
                            <th class="pb-4 px-4">Order ID</th>
                            <th class="pb-4 px-4">Customer</th>
                            <th class="pb-4 px-4">Location</th>
                            <th class="pb-4 px-4">Amount</th>
                            <th class="pb-4 px-4">Status</th>
                            <th class="pb-4 px-4">Time</th>
                        </tr>
                    </thead>
                    <tbody id="orders-list">
                        <!-- Dynamic content -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, query, orderBy, limit, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Same config as kitchen dashboard
        const firebaseConfig = {
            apiKey: "AIzaSyAbkJpVWRXfOuG-VDp0dC0oGkPKo9VCZD0",
            authDomain: "fishburger-system.firebaseapp.com",
            projectId: "fishburger-system",
            storageBucket: "fishburger-system.firebasestorage.app",
            messagingSenderId: "1011829893886",
            appId: "1:1011829893886:web:626820e2eb475b2b45d3af",
            measurementId: "G-LHF8XPTL3G"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Chart Instances
        let salesChart, locationChart;

        // Initialize Charts
        function initCharts() {
            const ctx1 = document.getElementById('salesChart').getContext('2d');
            const ctx2 = document.getElementById('locationChart').getContext('2d');

            salesChart = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Sales (DH)',
                        data: [0, 0, 0, 0, 0, 0, 0],
                        borderColor: '#FF4500',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        backgroundColor: (context) => {
                            const chart = context.chart;
                            const { ctx, chartArea } = chart;
                            if (!chartArea) return;
                            const gradient = ctx.createLinearGradient(0, chartArea.bottom, 0, chartArea.top);
                            gradient.addColorStop(0, 'rgba(255, 69, 0, 0)');
                            gradient.addColorStop(1, 'rgba(255, 69, 0, 0.15)');
                            return gradient;
                        },
                        pointBackgroundColor: '#FF4500',
                        pointBorderColor: '#0b0f19',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            grid: { color: 'rgba(255, 255, 255, 0.05)' },
                            ticks: { color: '#64748b' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#64748b' }
                        }
                    }
                }
            });

            locationChart = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['Rooftop', 'Medina', 'Casablanca'],
                    datasets: [{
                        data: [0, 0, 0],
                        backgroundColor: ['#3b82f6', '#22c55e', '#f97316'],
                        borderWidth: 0,
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '80%',
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        // Real-time Data Listener
        function subscribeToData() {
            const q = query(collection(db, 'orders'), orderBy('timestamp', 'desc'), limit(50));

            onSnapshot(q, (snapshot) => {
                const orders = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                updateDashboard(orders);
            });
        }

        function updateDashboard(orders) {
            // Stats Calculations
            const today = new Date().toISOString().split('T')[0];
            const completedToday = orders.filter(o => o.status === 'completed' || o.status === 'ready' || o.status === 'out-for-delivery');
            const pendingOrders = orders.filter(o => o.status === 'pending');

            const totalRevenue = completedToday.reduce((sum, o) => sum + (o.total || 0), 0);
            const totalOrders = completedToday.length;
            const avgBill = totalOrders > 0 ? Math.round(totalRevenue / totalOrders) : 0;

            // Update Stats Display
            document.getElementById('stat-revenue').innerText = `${totalRevenue} DH`;
            document.getElementById('stat-orders').innerText = totalOrders;
            document.getElementById('stat-avg').innerText = `${avgBill} DH`;
            document.getElementById('stat-pending').innerText = pendingOrders.length;

            // Update Location Data
            const locCounts = { rooftop: 0, medina: 0, casa: 0 };
            orders.forEach(o => {
                if (o.location && locCounts[o.location] !== undefined) locCounts[o.location]++;
            });

            const locTotal = locCounts.rooftop + locCounts.medina + locCounts.casa;
            if (locTotal > 0) {
                document.getElementById('loc-rooftop').innerText = `${Math.round((locCounts.rooftop / locTotal) * 100)}%`;
                document.getElementById('loc-medina').innerText = `${Math.round((locCounts.medina / locTotal) * 100)}%`;
                document.getElementById('loc-casa').innerText = `${Math.round((locCounts.casa / locTotal) * 100)}%`;

                locationChart.data.datasets[0].data = [locCounts.rooftop, locCounts.medina, locCounts.casa];
                locationChart.update();
            }

            // Update Recent Orders Table
            const tbody = document.getElementById('orders-list');
            tbody.innerHTML = '';

            orders.slice(0, 10).forEach(order => {
                const tr = document.createElement('tr');
                tr.className = 'border-b border-slate-800/50 hover:bg-slate-800/20 transition-all';

                const timeStr = order.timestamp?.toDate ?
                    order.timestamp.toDate().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) :
                    new Date(order.createdAt || Date.now()).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

                const statusStyles = {
                    'pending': 'bg-yellow-500/10 text-yellow-500 border-yellow-500/20',
                    'preparing': 'bg-blue-500/10 text-blue-500 border-blue-500/20',
                    'ready': 'bg-green-500/10 text-green-500 border-green-500/20',
                    'out-for-delivery': 'bg-purple-500/10 text-purple-500 border-purple-500/20',
                    'completed': 'bg-emerald-500/10 text-emerald-500 border-emerald-500/20'
                };

                tr.innerHTML = `
                    <td class="py-4 px-4 font-bold text-slate-300">#${String(order.orderNumber || '0').padStart(3, '0')}</td>
                    <td class="py-4 px-4">
                        <div class="font-semibold text-white">${order.customer?.name || 'Guest'}</div>
                        <div class="text-xs text-slate-500">${order.customer?.phone || 'No Phone'}</div>
                    </td>
                    <td class="py-4 px-4 capitalize font-medium">${order.location || 'Unknown'}</td>
                    <td class="py-4 px-4 font-bold text-white">${order.total || 0} DH</td>
                    <td class="py-4 px-4">
                        <span class="px-3 py-1 rounded-lg text-xs font-bold border ${statusStyles[order.status] || 'bg-slate-500/10 text-slate-500 border-slate-500/20'}">
                            ${(order.status || 'unknown').replace(/-/g, ' ')}
                        </span>
                    </td>
                    <td class="py-4 px-4 text-sm text-slate-400 font-medium">${timeStr}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Time Update
        function updateTime() {
            const now = new Date();
            document.getElementById('current-time').innerText = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        }

        // Init everything
        document.addEventListener('DOMContentLoaded', () => {
            initCharts();
            subscribeToData();
            setInterval(updateTime, 1000);
            updateTime();
        });
    </script>
</body>

</html>